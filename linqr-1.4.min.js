/*
 * Copyright (c) 2015 Kameron Brooks
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy,
 * modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software
 * is furnished to do so, subject to the following conditions:
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
 * IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

 */
function include(n,e){null!==linqrJS.findUnit(n)||linqrJS.addUnit(e,n)}var linqrJS=function(){function n(){return f>=2}function e(){console.log(f),1>f?f+=1:window.main&&window.main()}function o(n){if(n&&n.source)for(var e,o=/include\((.+)\)/gm;null!==(e=o.exec(n.source));){e.splice(0,1);var l=e[0].split(/,/g),r=(1,eval)(l[1]||void 0),t=(1,eval)(l[0]),u=i(t);n.children.push(u?u:c(r,t))}}function i(n){var e,o=a.length;for(e=0;o>e;e+=1)if(a[e].file===n)return a[e];return null}function l(){d+=arguments[0]||1}function r(){d-=arguments[0]||1,d>0||u()}function t(n){var e,o=n.children.length,i=!0;if(n.compiled)return!0;for(e=0;o>e;e+=1)i&=t(n.children[e]);if(i){s&&console.log("compiling unit: "+n.file);try{n.name?window[n.name]=(1,eval)(n.source):(1,eval)(n.source)}catch(l){console.log("Compilation Error: ["+n.file+"]: "+l.message)}n.compiled=!0}return i}function u(){var n,o=a.length,i=!0;for(n=0;o>n;n+=1)i&=t(a[n]);i?e():console.log("Compilation Error: Failed to compile units, main function not called")}function c(n,e){var i={name:n,file:e,source:null,children:[],loaded:!1,compiled:!1};s&&console.log("adding unit: "+e),a.push(i),l(1);var t=new XMLHttpRequest,u=null;return t.open("GET",e,!0),t.onload=function(){t.status>=200&&t.status<400?(u=t.responseText,i.source=u,i.loaded=!0,s&&console.log("unit source loaded: "+e),o(i),r(1)):console.log("Warning: the specified module in file ["+e+"] could not be loaded")},t.send(null),i}var a=[],d=0,s=!0,f=0;return window.addEventListener("load",e),{addUnit:c,compile:u,findUnit:i,isReady:n}}();